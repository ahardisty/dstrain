DROP TABLE IF EXISTS `rda`.`rdadata`.`model_population_a`; CREATE TABLE `rda`.`rdadata`.`model_population_a` (snapshot_typ, snapshot_nm, uniq_sa_id, cmprs_rt_sched_cd, deriv_baseline_terr_cd, opr_area_cd, max_sa_dt, model_id, group_id) PARTITION BY (group_id) AS (SELECT snapshot_typ, snapshot_nm, uniq_sa_id, cmprs_rt_sched_cd, deriv_baseline_terr_cd, opr_area_cd, CASE WHEN sa_end_dt > CURRENT_DATE THEN CURRENT_DATE ELSE sa_end_dt END max_sa_dt, ROW_NUMBER() OVER (PARTITION BY deriv_baseline_terr_cd) AS model_id, (ROW_NUMBER() OVER (PARTITION BY deriv_baseline_terr_cd)/CAST(100000 AS INTEGER)) + 1 AS group_id FROM `rda`.`rdatables`.`cust_yearly` AS cust WHERE sa_sta_cd = 20 AND snapshot_typ = 'ROLLING' AND res_ind = 'Y' AND net_mtr_ind = 'N' AND cmprs_rt_sched_cd IN('E1','E1L','E6','E6L','ETOUA','ETOUAL','ETOUB','ETOUBL','ETOUP1','ETOUP1L','ETOUP2','ETOUP2L','ETOUP3','ETOUP3L') AND deriv_rt_sched_cd NOT LIKE ('SE%') AND deriv_baseline_terr_cd = 'A' )
