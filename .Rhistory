}
seq_along(wea_tou_query)
for (i in seq_along(wea_tou_query)) {
readr::write_file(wea_tou_query[i], path = 'data/00_query.sql', append = TRUE)
}
wea_tou_query[i]
i
for (i in seq_along(wea_tou_query)) {
readr::write_file(x = wea_tou_query[i], path = 'data/00_query.sql', append = TRUE)
}
lapply(wea_tou_query, function(x){length(x)})
lapply(wea_tou_query, function(x){nchar(x)})
lapply(wea_tou_query, function(x){readr::write_file(x = x, path = path = 'data/query.sql'))})
lapply(wea_tou_query, function(x){readr::write_file(x = x, path = 'data/query.sql'))})
lapply(wea_tou_query, function(x) {
readr::write_file(x = x, path = 'data/query.sql'))
})
lapply(wea_tou_query, function(x) {
readr::write_file(x = x, path = 'data/query.sql')
})
lapply(wea_tou_query, function(x) {readr::write_file(x = x, path = 'data/query.sql')})
lapply(wea_tou_query, function(x) readr::write_file(x = x, path = 'data/query.sql'))
wea_yr = 2017
tou = "hetoua"
wea_id = "(1, 22, 23)"
wea_src = "PGE"
train = TRUE
obj_nm <- paste0(
"`",paste("wea",wea_yr, tou, sep = "_"),"`")
create_head <- paste(
paste0("DROP TABLE IF EXISTS `rda`.`rdadata`.",obj_nm),
paste0("CREATE TABLE `rda`.`rdadata`.",obj_nm), sep = ';\n')
part_body <- c(
"(calendar_date,
month_of_year,
day_of_month,
train_year,
predict_year,
day_of_week,
week_of_year,
quarter_of_year,
day_of_year,
day_of_year_shift,
wea_data_typ_id,
wea_data_typ_cd,
baseline_terr_cd,
opr_area_cd,
wea_hr,
rt_sched_cd,
tou_cd, meas_val)"
)
part_str <-  c(
"PARITION BY (day_of_year)")
agg_head <-  c(
"AS (SELECT wea.calendar_date,
wea.month_of_year,
wea.day_of_month,
wea.train_year,
wea.predict_year,
wea.day_of_week,
wea.week_of_year,
wea.quarter_of_year,
wea.day_of_year,
wea.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_data_typ_cd,
wea.baseline_terr_cd,
wea.opr_area_cd,
wea.wea_hr,
tou.rt_sched_cd,
tou.tou_cd,
AVG(wea.meas_val) AS meas_val FROM"
)
join_head <- c(
"(SELECT
xref.calendar_date,
xref.month_of_year,
xref.day_of_month,
xref.train_year,
xref.predict_year,
xref.day_of_week,
xref.week_of_year,
xref.quarter_of_year,
xref.day_of_year,
xref.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_dt,
wea.wea_dttm,
typ.wea_data_typ_cd,
terr_xref.baseline_terr_cd,
area_xref.opr_area_cd,
DATE_PART('hour', wea.wea_dttm) AS wea_hr,
CAST(wea.meas_val AS FLOAT) meas_val"
)
from_body <- c(
"FROM `rda`.`rdadata`.`time_shift_xref` AS xref"
)
join_body <- c(
"JOIN `rda`.`rdatables`.`weather_data`  AS wea
ON xref.calendar_date = wea.wea_dt
JOIN `rda`.`rdatables`.`weather_station` AS stn
ON wea.wea_stn_cd = stn.wea_stn_cd
JOIN `rda`.`rdatables`.`weather_data_type` AS typ
ON wea.wea_data_typ_id = typ.wea_data_typ_id
INNER JOIN `rda`.`rdatables`.`weather_baseline_terr_xref` AS terr_xref
ON wea.wea_stn_cd = terr_xref.wea_stn_cd
AND xref.month_of_year = terr_xref.mo_id
JOIN `rda`.`rdatables`.`weather_op_area_xref` AS area_xref
ON terr_xref.wea_stn_cd = area_xref.wea_stn_cd"
)
where <- paste(
"WHERE xref.train_year =", wea_yr,
"AND wea.wea_data_typ_id IN", wea_id,
"AND stn.wea_stn_owner =", wea_src,
") AS wea")
tou_body <- c(
"JOIN `rda`.`rdadata`.`tou_lookup_2017_hetoua` AS tou
ON wea.calendar_date = tou.calendar_date
AND wea.wea_dttm BETWEEN tou.tou_data_from_dttm AND tou.tou_data_to_dttm")
agg_body <- c(
"GROUP BY
wea.calendar_date,
wea.month_of_year,
wea.day_of_month,
wea.train_year,
wea.predict_year,
wea.day_of_week,
wea.week_of_year,
wea.quarter_of_year,
wea.day_of_year,
wea.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_data_typ_cd,
wea.baseline_terr_cd,
wea.opr_area_cd,
wea.wea_hr,
tou.rt_sched_cd,
tou.tou_cd")
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body)
lapply(wea_tou_query, function(x) readr::write_file(x = x, path = 'data/query.sql'))
lapply(wea_tou_query, function(x) readr::write_file(x, path = 'data/query.sql'))
wea_tou_query[[1]]
readr::write_file(wea_tou_query[[1]], path = 'data/query.sql'))
readr::write_file(wea_tou_query[[1]], path = 'data/query.sql')
lapply(wea_tou_query, function(x) readr::write_file(x, path = 'data/query.sql'))
wea_tou_query <- c(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body)
wea_tou_query
lapply(wea_tou_query, function(x) nchar(x)) # create list of test DT
lapply(wea_tou_query, function(x) summary(x)) # create list of test DT
readr::write_lines(wea_tou_query)
wea_tou_query
wea_tou_query[[1]]
readr::write_lines(wea_tou_query[[1]], path  = 'data/sal/query.sql'))
readr::write_lines(wea_tou_query[[1]], path  = 'data/sal/query.sql')
wea_tou_query[[1]]
readr::write_lines(wea_tou_query[[1]], path  = 'data/sql/')
readr::write_lines(wea_tou_query[[1]], path  = 'data/sql/query.sql')
x <- wea_tou_query[[1]]
readr::write_lines(wea_tou_query[[2]], path  = 'data/sql/query.sql')
x <- wea_tou_query[[1]]
readr::write_lines(x, path  = 'data/sql/query.sql', append = TRUE)
readr::write_lines(x, path  = 'data/sql/query.sql', append = TRUE)
readr::write_lines(x, path  = 'data/sql/query.sql', append = TRUE)
readr::write_lines(x, path  = 'data/sql/query.sql', append = TRUE)
wea_tou_query <- paste(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body)
wea_tou_query
x <- wea_tou_query[[1]]
x
wea_tou_query
wea_tou_query
wea_tou_query
wea_tou_query <- c(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body)
wea_tou_query
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body)
wea_tou_query
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
wea_tou_query
agg_body <- c(
"GROUP BY
wea.calendar_date,
wea.month_of_year,
wea.day_of_month,
wea.train_year,
wea.predict_year,
wea.day_of_week,
wea.week_of_year,
wea.quarter_of_year,
wea.day_of_year,
wea.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_data_typ_cd,
wea.baseline_terr_cd,
wea.opr_area_cd,
wea.wea_hr,
tou.rt_sched_cd,
tou.tou_cd)")
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
wea_tou_query
wea_tou_query <- paste(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
wea_tou_query
x <- wea_tou_query
readr::write_lines(x, path  = 'data/sql/query.sql', append = TRUE)
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
x <- wea_tou_query
readr::write_lines(x, path  = 'data/sql/query.sql', append = TRUE)
wea_tou_query
x <- wea_tou_query
x
readr::write_lines(x, path  = 'data/sql/query.sql', append = TRUE)
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
stringr::str_replace_all(string = wea_tou_query, pattern = '[\n]', replacement = ' ')
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
wea_tou_query <- stringr::str_replace_all(string = wea_tou_query, pattern = '[\n]', replacement = '')
wea_tou_query
x <- wea_tou_query
readr::write_lines(wea_tou_query, path  = 'data/sql/query.sql', append = TRUE)
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
readr::write_lines(wea_tou_query, path  = 'data/sql/query.sql', append = FALSE)
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
readr::write_lines(wea_tou_query, path  = 'data/sql/query.sql', append = FALSE)
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
readr::write_lines(wea_tou_query, path  = 'data/sql/query.sql', append = FALSE)
readr::write_lines(wea_tou_query, path  = 'data/sql/query.sql', append = FALSE)
join_head <- c(
"(SELECT xref.calendar_date,
xref.month_of_year,
xref.day_of_month,
xref.train_year,
xref.predict_year,
xref.day_of_week,
xref.week_of_year,
xref.quarter_of_year,
xref.day_of_year,
xref.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_dt,
wea.wea_dttm,
typ.wea_data_typ_cd,
terr_xref.baseline_terr_cd,
area_xref.opr_area_cd,
DATE_PART('hour', wea.wea_dttm) AS wea_hr,
CAST(wea.meas_val AS FLOAT) meas_val"
)
wea_yr = 2017
tou = "hetoua"
wea_id = "(1, 22, 23)"
wea_src = "PGE"
train = TRUE
obj_nm <- paste0(
"`",paste("wea",wea_yr, tou, sep = "_"),"`")
create_head <- paste(
paste0("DROP TABLE IF EXISTS `rda`.`rdadata`.",obj_nm),
paste0("CREATE TABLE `rda`.`rdadata`.",obj_nm), sep = ';\n')
part_body <- c(
"(calendar_date,
month_of_year,
day_of_month,
train_year,
predict_year,
day_of_week,
week_of_year,
quarter_of_year,
day_of_year,
day_of_year_shift,
wea_data_typ_id,
wea_data_typ_cd,
baseline_terr_cd,
opr_area_cd,
wea_hr,
rt_sched_cd,
tou_cd, meas_val)"
)
part_str <-  c(
"PARITION BY (day_of_year)")
agg_head <-  c(
"AS (SELECT wea.calendar_date,
wea.month_of_year,
wea.day_of_month,
wea.train_year,
wea.predict_year,
wea.day_of_week,
wea.week_of_year,
wea.quarter_of_year,
wea.day_of_year,
wea.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_data_typ_cd,
wea.baseline_terr_cd,
wea.opr_area_cd,
wea.wea_hr,
tou.rt_sched_cd,
tou.tou_cd,
AVG(wea.meas_val) AS meas_val FROM"
)
join_head <- c(
"(SELECT xref.calendar_date,
xref.month_of_year,
xref.day_of_month,
xref.train_year,
xref.predict_year,
xref.day_of_week,
xref.week_of_year,
xref.quarter_of_year,
xref.day_of_year,
xref.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_dt,
wea.wea_dttm,
typ.wea_data_typ_cd,
terr_xref.baseline_terr_cd,
area_xref.opr_area_cd,
DATE_PART('hour', wea.wea_dttm) AS wea_hr,
CAST(wea.meas_val AS FLOAT) meas_val"
)
from_body <- c(
"FROM `rda`.`rdadata`.`time_shift_xref` AS xref"
)
join_body <- c(
"JOIN `rda`.`rdatables`.`weather_data`  AS wea
ON xref.calendar_date = wea.wea_dt
JOIN `rda`.`rdatables`.`weather_station` AS stn
ON wea.wea_stn_cd = stn.wea_stn_cd
JOIN `rda`.`rdatables`.`weather_data_type` AS typ
ON wea.wea_data_typ_id = typ.wea_data_typ_id
INNER JOIN `rda`.`rdatables`.`weather_baseline_terr_xref` AS terr_xref
ON wea.wea_stn_cd = terr_xref.wea_stn_cd
AND xref.month_of_year = terr_xref.mo_id
JOIN `rda`.`rdatables`.`weather_op_area_xref` AS area_xref
ON terr_xref.wea_stn_cd = area_xref.wea_stn_cd"
)
where <- paste(
"WHERE xref.train_year =", wea_yr,
"AND wea.wea_data_typ_id IN", wea_id,
"AND stn.wea_stn_owner =", wea_src,
") AS wea")
tou_body <- c(
"JOIN `rda`.`rdadata`.`tou_lookup_2017_hetoua` AS tou
ON wea.calendar_date = tou.calendar_date
AND wea.wea_dttm BETWEEN tou.tou_data_from_dttm AND tou.tou_data_to_dttm")
agg_body <- c(
"GROUP BY
wea.calendar_date,
wea.month_of_year,
wea.day_of_month,
wea.train_year,
wea.predict_year,
wea.day_of_week,
wea.week_of_year,
wea.quarter_of_year,
wea.day_of_year,
wea.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_data_typ_cd,
wea.baseline_terr_cd,
wea.opr_area_cd,
wea.wea_hr,
tou.rt_sched_cd,
tou.tou_cd)")
devtools::load_all(".")
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
wea_tou_query
source('~/Documents/dstrain/R/reframe_wea_sql.R', echo=TRUE)
wea_yr = 2017
tou = "hetoua"
wea_id = "(1, 22, 23)"
wea_src = "PGE"
train = TRUE
obj_nm <- paste0(
"`",paste("wea",wea_yr, tou, sep = "_"),"`")
create_head <- paste(
paste0("DROP TABLE IF EXISTS `rda`.`rdadata`.",obj_nm),
paste0("CREATE TABLE `rda`.`rdadata`.",obj_nm), sep = ';\n')
part_body <- c(
"(calendar_date,
month_of_year,
day_of_month,
train_year,
predict_year,
day_of_week,
week_of_year,
quarter_of_year,
day_of_year,
day_of_year_shift,
wea_data_typ_id,
wea_data_typ_cd,
baseline_terr_cd,
opr_area_cd,
wea_hr,
rt_sched_cd,
tou_cd, meas_val)"
)
part_str <-  c(
"PARITION BY (day_of_year)")
agg_head <-  c(
"AS (SELECT wea.calendar_date,
wea.month_of_year,
wea.day_of_month,
wea.train_year,
wea.predict_year,
wea.day_of_week,
wea.week_of_year,
wea.quarter_of_year,
wea.day_of_year,
wea.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_data_typ_cd,
wea.baseline_terr_cd,
wea.opr_area_cd,
wea.wea_hr,
tou.rt_sched_cd,
tou.tou_cd,
AVG(wea.meas_val) AS meas_val FROM"
)
join_head <- c(
"(SELECT xref.calendar_date,
xref.month_of_year,
xref.day_of_month,
xref.train_year,
xref.predict_year,
xref.day_of_week,
xref.week_of_year,
xref.quarter_of_year,
xref.day_of_year,
xref.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_dt,
wea.wea_dttm,
typ.wea_data_typ_cd,
terr_xref.baseline_terr_cd,
area_xref.opr_area_cd,
DATE_PART('hour', wea.wea_dttm) AS wea_hr,
CAST(wea.meas_val AS FLOAT) meas_val"
)
from_body <- c(
"FROM `rda`.`rdadata`.`time_shift_xref` AS xref"
)
join_body <- c(
"JOIN `rda`.`rdatables`.`weather_data`  AS wea
ON xref.calendar_date = wea.wea_dt
JOIN `rda`.`rdatables`.`weather_station` AS stn
ON wea.wea_stn_cd = stn.wea_stn_cd
JOIN `rda`.`rdatables`.`weather_data_type` AS typ
ON wea.wea_data_typ_id = typ.wea_data_typ_id
INNER JOIN `rda`.`rdatables`.`weather_baseline_terr_xref` AS terr_xref
ON wea.wea_stn_cd = terr_xref.wea_stn_cd
AND xref.month_of_year = terr_xref.mo_id
JOIN `rda`.`rdatables`.`weather_op_area_xref` AS area_xref
ON terr_xref.wea_stn_cd = area_xref.wea_stn_cd"
)
where <- paste(
"WHERE xref.train_year =", wea_yr,
"AND wea.wea_data_typ_id IN", wea_id,
"AND stn.wea_stn_owner =", wea_src,
") AS wea")
tou_body <- c(
"JOIN `rda`.`rdadata`.`tou_lookup_2017_hetoua` AS tou
ON wea.calendar_date = tou.calendar_date
AND wea.wea_dttm BETWEEN tou.tou_data_from_dttm AND tou.tou_data_to_dttm")
agg_body <- c(
"GROUP BY
wea.calendar_date,
wea.month_of_year,
wea.day_of_month,
wea.train_year,
wea.predict_year,
wea.day_of_week,
wea.week_of_year,
wea.quarter_of_year,
wea.day_of_year,
wea.day_of_year_shift,
wea.wea_data_typ_id,
wea.wea_data_typ_cd,
wea.baseline_terr_cd,
wea.opr_area_cd,
wea.wea_hr,
tou.rt_sched_cd,
tou.tou_cd)")
wea_tou_query <- list(create_head,part_body, part_str,agg_head, join_head, from_body, join_body, where, tou_body, agg_body)
readr::write_lines(wea_tou_query, path  = 'data/sql/query.sql', append = FALSE)
source('~/Documents/dstrain/R/reframe_wea_sql.R', echo=TRUE)
reframe_wea_sql()
reframe_wea_sql()
obj_nm
obj_nm <- paste0(
"`",paste("wea",wea_yr, tou, sep = "_"),"`")
wea_yr = 2017
tou = "hetoua"
wea_id = "(1, 22, 23)"
wea_src = "PGE"
train = TRUE
reframe_wea_db
obj_nm <- paste0(
"`",paste("wea",wea_yr, tou, sep = "_"),"`")
obj_nm
paste(
"wea",wea_yr, tou, sep = "_")
obj_out <- paste(
"wea",wea_yr, tou, sep = "_")
out_path <- paste(obj_out,".sql")
out_path
out_path <- paste0(obj_out,".sql")
out_path
out_path <- paste0('data/sql/',obj_out,".sql")
out_path
readr::write_lines(wea_tou_query, path  = out_path, append = FALSE)
source('~/Documents/dstrain/R/reframe_wea_sql.R', echo=TRUE)
source('~/Documents/dstrain/R/reframe_wea_sql.R', echo=TRUE)
source('~/Documents/dstrain/R/reframe_wea_sql.R', echo=TRUE)
source('~/Documents/dstrain/R/reframe_wea_sql.R', echo=TRUE)
source('~/Documents/dstrain/R/reframe_wea_sql.R', echo=TRUE)
source('~/Documents/dstrain/R/reframe_wea_sql.R', echo=TRUE)
